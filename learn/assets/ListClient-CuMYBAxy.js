import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{b as ae,a as se,A as R}from"./use-api-CkHLgVxI.js";import{d as te}from"./debounce-D9ctexka.js";import{a as I}from"./local-storage-DWUcO9io.js";import{U as F}from"./url-path-DazeSMIU.js";import{r as b,L as z}from"./chunk-QMGIS6GS-DZztEkVs.js";import{t as ne}from"./index-CGgTmrc1.js";import{D as re}from"./DeleteModal-d_69eadW.js";import{c as y}from"./utils-BA6gyYTm.js";import{I as V}from"./input-D-_1mv6L.js";import{S as O,a as K,b as Q,c as q,d as U,C as B,e as ie}from"./select-7mBtS6Ys.js";import{N as le,C as oe,f as ce,j as de,a as ue,b as xe,c as h,d as he,e as me,g as T,h as H,D as pe,i as ge}from"./base-store-C-qtuD4s.js";import{L as fe}from"./ClientComponent-DCGFJxP_.js";import{B as E,A as D}from"./button-DZ4teuIw.js";import{u as L}from"./useTranslation-BTxYNbzO.js";import{L as Y}from"./label-2IwhEJvq.js";import{S as je}from"./search-BwrN1phU.js";import{C as be}from"./circle-check-big-DGckQVje.js";import"./QueryClientProvider-CHEzqbNR.js";import"./auth-_r7jvU0l.js";import"./eye-P0uHH9uI.js";import"./loader-circle-CzWM3YVe.js";import"./index-Eq7z2fNl.js";import"./dialog-BMIEr9-h.js";import"./index-BQ_PequZ.js";import"./Combination-BuQb3gNO.js";import"./i18nInstance-CZ4THbp4.js";import"./index-B39MSPx1.js";import"./chevron-right-Cji9ihin.js";import"./preload-helper-B6OyRjpI.js";function ye({className:t,...r}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:y("w-full caption-bottom text-sm",t),...r})})}function ke({className:t,...r}){return e.jsx("thead",{"data-slot":"table-header",className:y("[&_tr]:border-b",t),...r})}function Se({className:t,...r}){return e.jsx("tbody",{"data-slot":"table-body",className:y("[&_tr:last-child]:border-0",t),...r})}function v({className:t,...r}){return e.jsx("tr",{"data-slot":"table-row",className:y("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...r})}function $({className:t,...r}){return e.jsx("th",{"data-slot":"table-head",className:y("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})}function N({className:t,...r}){return e.jsx("td",{"data-slot":"table-cell",className:y("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})}function ve({queryResponse:t,data:r,colSpan:u=1,children:d}){return e.jsx(e.Fragment,{children:t.query.isLoading?e.jsx(v,{children:e.jsx(N,{colSpan:u,children:e.jsx(fe,{})})}):t.query.isError?e.jsx(v,{children:e.jsx(N,{colSpan:u,children:e.jsx("div",{className:"flex flex-col items-center gap-2 text-xl font-bold text-red-500",children:e.jsx("p",{children:t.query.error.message})})})}):r.length===0?e.jsx(v,{children:e.jsx(N,{colSpan:u,children:e.jsx(le,{})})}):r.map(m=>d(m))})}function Ne({queryResponse:t,refreshQuerykey:r,actionBeforeReload:u}){const{t:d}=L(["common"]),m=ae();return e.jsx(E,{loading:t.query.isFetching,icon:D.RELOAD,onClick:()=>{u==null||u(),m.call(r),t.query.refetch().then(g=>{g.isSuccess&&ne.success(d("pagination.reloadSuccess",{ns:"common"}))})},children:d("pagination.reload",{ns:"common"})})}const M="all";function Ce({queryResponse:t,columns:r,searchPlaceholder:u,pageSizeOptions:d=de,refreshQuerykey:m,urlCreate:g,urlEdit:k,onDelete:S,dataSearch:p,rowActions:f,debounceDelay:w=500,store:s}){const{t:o}=L(["common"]),[G,Z]=b.useState(0),P=te((a,n)=>{s.setSearchTerm(a,n)},w),C=(a,n)=>{P(a,n)},J=()=>{s.reset(),Z(a=>a+1)};b.useEffect(()=>()=>{P.cancel()},[P]);const j=b.useMemo(()=>{let a=[...t.query.data||[]];return p?a=a.filter(n=>Object.entries(s.searchTerm).every(([c,l])=>{if(l==="")return!0;const i=p.find(_=>_.key===c);return i?i.searchFn(n,l):!0})):a=a.filter(n=>r.some(c=>{if(!c.searchable)return!1;const l=n[c.key];return l==null?!1:l.toString().toLowerCase().includes((s.searchTerm[M]||"").toLowerCase())})),s.sortConfig.key&&a.sort((n,c)=>{const l=n[s.sortConfig.key],i=c[s.sortConfig.key];return l==null?s.sortConfig.direction==="asc"?-1:1:i==null?s.sortConfig.direction==="asc"?1:-1:s.sortConfig.type==="number"?s.sortConfig.direction==="asc"?Number(l)-Number(i):Number(i)-Number(l):l<i?s.sortConfig.direction==="asc"?-1:1:l>i?s.sortConfig.direction==="asc"?1:-1:0}),a},[t.query.data,s.searchTerm,s.sortConfig,r,p]),x=Math.ceil(j.length/s.pagination.pageSize),W=b.useMemo(()=>{const a=s.pagination.pageIndex*s.pagination.pageSize;return j.slice(a,a+s.pagination.pageSize)},[j,s.pagination.pageIndex,s.pagination.pageSize]),X=({column:a})=>s.sortConfig.key!==a?e.jsx(B,{className:"ml-1 h-4 w-4 opacity-0 group-hover:opacity-70"}):s.sortConfig.direction==="asc"?e.jsx(ie,{className:"ml-1 h-4 w-4"}):e.jsx(B,{className:"ml-1 h-4 w-4"}),ee=()=>{const a=[];if(x<=5)for(let c=0;c<x;c++)a.push(e.jsx(h,{children:e.jsx(T,{href:"#",isActive:s.pagination.pageIndex===c,onClick:l=>{l.preventDefault(),s.setPageIndex(c)},children:c+1})},c));else{a.push(e.jsx(h,{children:e.jsx(T,{href:"#",isActive:s.pagination.pageIndex===0,onClick:i=>{i.preventDefault(),s.setPageIndex(0)},children:"1"})},0)),s.pagination.pageIndex>2&&a.push(e.jsx(h,{children:e.jsx(H,{})},"ellipsis1"));const c=Math.max(1,s.pagination.pageIndex-1),l=Math.min(x-2,s.pagination.pageIndex+1);for(let i=c;i<=l;i++)a.push(e.jsx(h,{children:e.jsx(T,{href:"#",isActive:s.pagination.pageIndex===i,onClick:_=>{_.preventDefault(),s.setPageIndex(i)},children:i+1})},i));s.pagination.pageIndex<x-3&&a.push(e.jsx(h,{children:e.jsx(H,{})},"ellipsis2")),x>1&&a.push(e.jsx(h,{children:e.jsx(T,{href:"#",isActive:s.pagination.pageIndex===x-1,onClick:i=>{i.preventDefault(),s.setPageIndex(x-1)},children:x})},x-1))}return a},A=f||k||S;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx("div",{className:"relative flex-1",children:p?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[e.jsxs(Y,{className:"text-muted-foreground text-sm",children:[o("pagination.search",{ns:"common"}),":"]}),p.map(a=>e.jsxs("div",{children:[a.type==="input"&&e.jsx(V,{placeholder:a.label,onChange:n=>C(a.key,n.target.value),defaultValue:s.searchTerm[a.key]}),a.type==="select"&&a.options&&e.jsxs(O,{onValueChange:n=>C(a.key,n==="all"?"":n),defaultValue:s.searchTerm[a.key],children:[e.jsx(K,{className:"max-w-sm",id:a.key,children:e.jsx(Q,{placeholder:a.label})}),e.jsxs(q,{children:[e.jsx(U,{value:"all",children:a.label}),a.options.map(n=>e.jsx(U,{value:n.value,children:n.label},n.value))]})]}),a.type==="checkbox"&&e.jsxs("div",{className:"flex h-9 items-center space-x-2 rounded-md border px-3 py-2",children:[e.jsx(oe,{id:a.key,checked:s.searchTerm[a.key],onCheckedChange:n=>C(a.key,n)}),e.jsx(Y,{htmlFor:a.key,className:"cursor-pointer text-sm font-normal whitespace-nowrap",children:a.label})]})]},`${a.key}-${G}`))]})}):e.jsxs("div",{children:[e.jsx(je,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2"}),e.jsx(V,{placeholder:u||o("pagination.search",{ns:"common"}),className:"pl-9",value:s.searchTerm[M],onChange:a=>C(M,a.target.value)})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{queryResponse:t,refreshQuerykey:m,actionBeforeReload:J}),g&&e.jsx(z,{to:g,children:e.jsx(E,{icon:D.CREATE,children:o("actions.create",{ns:"common"})})})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(ye,{children:[e.jsx(ke,{children:e.jsxs(v,{children:[r.map(a=>e.jsx($,{className:a.sortable?"group cursor-pointer select-none":"",onClick:()=>a.sortable&&s.setSortConfig(a.key,a.sortable),children:e.jsxs("div",{className:"flex items-center",children:[a.header,a.sortable&&X({column:a.key})]})},String(a.key))),A&&e.jsx($,{className:"w-[120px]",children:o("actions.actions",{ns:"common"})})]})}),e.jsx(Se,{children:e.jsx(ve,{queryResponse:t,data:W,colSpan:r.length+(A?1:0),children:a=>e.jsxs(v,{children:[r.map(n=>e.jsx(N,{children:n.render?n.render(a[n.key],a):a[n.key]===null||a[n.key]===void 0?"-":n.date&&a[n.key]?ce(String(a[n.key]),pe):String(a[n.key])},String(n.key))),A&&e.jsx(N,{children:e.jsxs("div",{className:"flex gap-2",children:[k&&e.jsx(z,{to:k(String(a.id)),children:e.jsx(E,{variant:"outline",size:"icon",icon:D.EDIT})}),S&&e.jsx(E,{variant:"outline",size:"icon",icon:D.DELETE,onClick:()=>S(a)}),f==null?void 0:f(a)]})})]},String(a.id))})})]})}),e.jsxs("div",{className:"flex items-center justify-end px-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:o("pagination.showing",{from:j.length>0?s.pagination.pageIndex*s.pagination.pageSize+1:0,to:Math.min((s.pagination.pageIndex+1)*s.pagination.pageSize,j.length),total:j.length,ns:"common"})}),e.jsxs(O,{value:s.pagination.pageSize.toString(),onValueChange:a=>{s.setPageSize(Number(a))},children:[e.jsx(K,{className:"h-8 w-[70px]",children:e.jsx(Q,{placeholder:s.pagination.pageSize})}),e.jsx(q,{children:d.map(a=>e.jsx(U,{value:a.toString(),children:a},a))})]})]}),x>1&&e.jsx("div",{className:"ml-4 flex items-center space-x-2",children:e.jsx(ue,{children:e.jsxs(xe,{children:[e.jsx(h,{children:e.jsx(he,{href:"#",onClick:a=>{a.preventDefault(),s.setPageIndex(Math.max(0,s.pagination.pageIndex-1))},className:s.pagination.pageIndex===0?"pointer-events-none opacity-50":""})}),ee(),e.jsx(h,{children:e.jsx(me,{href:"#",onClick:a=>{a.preventDefault(),s.setPageIndex(Math.min(x-1,s.pagination.pageIndex+1))},className:s.pagination.pageIndex>=x-1?"pointer-events-none opacity-50":""})})]})})})]})]})}const Ie=ge();function Te(){const{t}=L(["common","users"]),[r,u]=b.useState(!1),[d,m]=b.useState(),g=Ie(),k=se({method:"get",url:R.USERS.LIST},{querykey:[I.USER_LIST],message:{default:t("errors.list_default",{ns:"users"})}}),S=[{key:"id",header:"ID",sortable:"number",searchable:!0},{key:"email",header:t("list.email",{ns:"users"}),sortable:!0,searchable:!0},{key:"name",header:t("list.name",{ns:"users"}),sortable:!0,searchable:!0},{key:"role",header:t("list.role",{ns:"users"}),sortable:!0,searchable:!0},{key:"status",header:t("list.status",{ns:"users"}),sortable:!0,searchable:!0,render:s=>s&&e.jsx(be,{className:"h-4 w-4 text-green-500"})},{key:"count",header:t("list.count",{ns:"users"}),sortable:!0,searchable:!0},{key:"createdAt",header:t("list.createdAt",{ns:"users"}),sortable:!0,searchable:!0,date:!0},{key:"updatedAt",header:t("list.updatedAt",{ns:"users"}),sortable:!0,searchable:!0,date:!0}],p=[{key:"id",label:"ID",searchFn:(s,o)=>s.id.includes(o),type:"input"},{key:"email",label:t("list.search_email_name",{ns:"users"}),searchFn:(s,o)=>s.email.toLowerCase().includes(o.toLowerCase())||s.name.toLowerCase().includes(o.toLowerCase()),type:"input"},{key:"role",label:t("list.role",{ns:"users"}),searchFn:(s,o)=>s.role.includes(o),type:"select",options:[{value:"admin",label:t("role.admin",{ns:"users"})},{value:"user",label:t("role.user",{ns:"users"})}]},{key:"status",label:t("list.status",{ns:"users"}),searchFn:(s,o)=>o?s.status:!0,type:"checkbox"},{key:"count",label:t("list.count",{ns:"users"}),searchFn:(s,o)=>s.count===Number(o),type:"input"}],f=s=>{m(s),u(!0)},w=d&&e.jsxs(re,{apiUrl:R.USERS.DELETE(d.id),open:r,setOpen:u,refreshQuerykey:[I.USER_LIST,[I.USER_DETAIL,d.id]],children:[e.jsx("p",{children:t("delete.description",{ns:"users"})}),e.jsxs("div",{className:"mt-5 flex flex-col gap-1",children:[e.jsxs("span",{children:[t("list.name",{ns:"users"}),": ",e.jsx("strong",{children:d.name})]}),e.jsxs("span",{children:[t("list.email",{ns:"users"}),": ",e.jsx("strong",{children:d.email})]}),e.jsxs("span",{children:["ID: ",e.jsx("strong",{children:d.id})]})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{queryResponse:k,columns:S,refreshQuerykey:[I.USER_LIST],urlCreate:F.ADMIN.USERS.CREATE,urlEdit:F.ADMIN.USERS.EDIT,onDelete:f,dataSearch:p,store:g}),w]})}function ra(){const{t}=L("users");return e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 flex items-center justify-between space-y-2",children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:t("list.title")})}),e.jsx(Te,{})]})}export{ra as default};
